---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.2.1
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
import pandas as pd, matplotlib.pyplot as plt, numpy as np
```

```{python}
data_dir = '../data/P00000001-ALL.csv'
```

```{python}
dateparse = lambda x: pd.datetime.strptime(x, '%d-%b-%y')
contributions = pd.read_csv(data_dir, index_col=False, parse_dates=['contb_receipt_dt'], date_parser=dateparse)
```

```{python}
repubs = contributions[contributions['cand_nm'] == 'Trump, Donald J.']
dems = contributions[contributions['cand_nm'] != 'Trump, Donald J.']
```

```{python}
print(f'Columns provided in data set: {",  ".join(contributions.columns)}')
print(f'\nNumber of contributions in dataset : {len(contributions)}')
```

```{python}
contributions.head()
```

# Contributions By Candidate

```{python}
contributions.groupby('cand_nm')['contb_receipt_amt'].sum().plot.bar()
plt.xlabel("Candidate")
plt.ylabel("Total Contributions ($)")
plt.title("Contributions by Candidate")
```

```{python}
contributions_by_individual = contributions.groupby('contbr_nm')['contb_receipt_amt'].sum().sort_values()
contributions_by_individual.tail()
```

# Plot of Contributions by State

```{python}
plt.figure(figsize=(15,15))
contributions.groupby('contbr_st')['contb_receipt_amt'].sum().plot.bar()
plt.xlabel('State')
plt.ylabel('Contributions')
plt.title('Total Contributions by State')
```

```{python}
plt.figure(figsize=(15,15))
dems.groupby('contbr_st')['contb_receipt_amt'].sum().plot.bar(label='Democrats', color='b')
repubs.groupby('contbr_st')['contb_receipt_amt'].sum().plot.bar(label='Republicans', color='r')
plt.legend()
```

# Above plot hides data, here is its opposite

```{python}
plt.figure(figsize=(15,15))
repubs.groupby('contbr_st')['contb_receipt_amt'].sum().plot.bar(label='Republicans', color='r')
dems.groupby('contbr_st')['contb_receipt_amt'].sum().plot.bar(label='Democrats', color='b')
plt.legend()
```

# Why is it so hard to have the bars be side by side and not overlapped :(

```{python}
plt.figure(figsize=(15,15))
n_states = len(contributions['contbr_st'].unique())
ind = np.arange(n_states)/4 + .15
width = .15
#dems.groupby('contbr_st')['contb_receipt_amt'].sum().plot.bar(x=ind, width=width, label='Democrats', color='b')
#repubs.groupby('contbr_st')['contb_receipt_amt'].sum().plot.bar(x=ind+width, width=width, label='Republicans', color='r')
t1 = dems.groupby('contbr_st')['contb_receipt_amt'].sum()
t2 = repubs.groupby('contbr_st')['contb_receipt_amt'].sum()
fig, ax = plt.subplots(figsize=(15,15))
ax.bar(ind, t1.values[0], width, label='Democrats')
ax.bar(ind+width, t2.values[0], width, label='Republicans')
ax.set_xticks(ind)
ax.set_xticklabels(t1.index)
plt.legend()
```

# Plotting contributions to a candidate over time
## List of Candidates

```{python}
print(contributions['cand_nm'].unique())
```

```{python}
def plot_contributions_over_time(candidates):
    for candidate in candidates:
        df = contributions[contributions['cand_nm'] == candidate].sort_values(by='contb_receipt_dt')
        df.index = df['contb_receipt_dt']
        df['contb_receipt_amt'].cumsum().plot(label=candidate)
    plt.ylabel('($) Contributions')
    plt.xlabel('Time')
    plt.title(f'Cumulative contributions')
    plt.legend()
plot_contributions_over_time(['Biden, Joseph R Jr', 'Yang, Andrew', 'Trump, Donald J.'])
```

## Contributors to Multiple Campaigns

```{python}
contributors_to_multiple_campaigns = contributions.groupby('contbr_nm').filter(lambda x : len(x['cand_nm'].unique()) > 1)
```

```{python}
contributors_to_multiple_campaigns.groupby(['contbr_nm', 'cand_nm']).sum()['contb_receipt_amt']
```

```{python}
print(f'Number of people contributing to multiple candidates: {len(contributors_to_multiple_campaigns["contbr_nm"].unique())}')
```

## Graph Construction
Options:
1. Undirected graph, unweighted (for now)
   - Draw an edge between contributors if they contributed to the same candidate

2. Directed multigraph, weighted
   - draw an edge from contributor to candidate with weight being amount of contributions
   
Need to be smart potentially about graph csonstruction, considering high number of edges with option(1)
Below code will crash kernel

```{python}
#import itertools
#edge_list = []
#contributions.groupby('cand_nm').apply(lambda x: edge_list.extend(itertools.combinations(x['contbr_nm'], #2)))
```
